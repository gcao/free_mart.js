// Generated by CoffeeScript 1.4.0
(function() {

  chai.should();

  describe(FreeMart, function() {
    beforeEach(function() {
      FreeMart.clear();
      return window.log = function() {};
    });
    it("register/request should work", function() {
      FreeMart.register('key', 'value');
      return FreeMart.request('key').should.equal('value');
    });
    it("register/request should invoke function with arguments", function() {
      FreeMart.register('key', function(_, arg1, arg2) {
        return "value " + arg1 + " " + arg2;
      });
      return FreeMart.request('key', 'a', 'b').should.equal('value a b');
    });
    it("requestAsync should work with simple value", function() {
      var result;
      FreeMart.register('key', 'value');
      result = null;
      FreeMart.requestAsync('key').then(function(value) {
        return result = value;
      });
      return result.should.equal('value');
    });
    it("requestAsync should work with functions", function() {
      var result;
      FreeMart.register('key', function() {
        return 'value';
      });
      result = null;
      FreeMart.requestAsync('key').then(function(value) {
        return result = value;
      });
      return result.should.equal('value');
    });
    it("requestAsync should work with promises", function() {
      var deferred, result;
      deferred = new Deferred();
      FreeMart.register('key', deferred);
      result = null;
      FreeMart.requestAsync('key').then(function(value) {
        return result = value;
      });
      deferred.resolve('value');
      return result.should.equal('value');
    });
    it("requestAsync should work if provider is registered later", function() {
      var result;
      result = null;
      FreeMart.requestAsync('key').then(function(value) {
        return result = value;
      });
      FreeMart.register('key', 'value');
      return result.should.equal('value');
    });
    it("requestAsync should work if provider is a function and is registered later", function() {
      var result;
      result = null;
      FreeMart.requestAsync('key').then(function(value) {
        return result = value;
      });
      FreeMart.register('key', function() {
        return 'value';
      });
      return result.should.equal('value');
    });
    it("requestAsync should work if provider is a deferred object and is registered later", function() {
      var deferred, result;
      result = null;
      FreeMart.requestAsync('key').then(function(value) {
        return result = value;
      });
      deferred = new Deferred();
      FreeMart.register('key', deferred);
      deferred.resolve('value');
      return result.should.equal('value');
    });
    return it("multiple requestAsync should work if provider is registered later", function() {
      var deferredA, requestA, resultA, resultB;
      window.log = function(msg) {
        return console.log(msg);
      };
      resultA = null;
      deferredA = new Deferred();
      requestA = FreeMart.requestAsync('key', deferredA).then(function(value) {
        console.log('=========');
        console.log(value);
        return resultA = value;
      });
      resultB = null;
      FreeMart.requestAsync('key', 'b').then(function(value) {
        return resultB = value;
      });
      FreeMart.register('key', function(_, arg) {
        console.log('---------');
        console.log(JSON.stringify(_));
        console.log(arg.promise);
        return arg;
      });
      deferredA.resolve('a');
      resultA.should.equal('a');
      return resultB.should.equal('b');
    });
  });

}).call(this);
